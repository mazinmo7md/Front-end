{% extends "base.html" %} {% load static %} {% block content %}
<div class="big">
  <div
    id="offersCarousel"
    class="carousel slide mb-5"
    data-bs-ride="carousel"
    style="max-width: 60vw; margin: auto"
  >
    <!-- Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="carousel-indicators">
      {% for offer in offers %}
      <button
        type="button"
        data-bs-target="#offersCarousel"
        data-bs-slide-to="{{ forloop.counter0 }}"
        class="{% if forloop.first %}active{% endif %}"
        aria-current="true"
        aria-label="Slide {{ forloop.counter }}"
      ></button>
      {% endfor %}
    </div>

    <!-- Ø§Ù„ØµÙˆØ± -->
    <div class="carousel-inner">
      {% if offers %} {% for offer in offers %}
      <div class="carousel-item {% if forloop.first %}active{% endif %}">
        {% if offer.link_category %}
        <a href="{% url 'shop:category' offer.link_category.slug %}">
          <img src="{{ offer.image.url }}" alt="{{ offer.alt }}" />
        </a>
        {% else %}
        <img src="{{ offer.image.url }}" alt="{{ offer.alt }}" />
        {% endif %}
      </div>
      {% endfor %} {% else %}
      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶.</p>
      {% endif %}
    </div>

    <!-- Ø§Ù„Ø£Ø³Ù‡Ù… -->
    <button
      class="carousel-control-prev"
      type="button"
      data-bs-target="#offersCarousel"
      data-bs-slide="prev"
    >
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
    </button>
    <button
      class="carousel-control-next"
      type="button"
      data-bs-target="#offersCarousel"
      data-bs-slide="next"
    >
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Ø§Ù„ØªØ§Ù„ÙŠ</span>
    </button>
  </div>

  <div class="categ">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£ÙÙ‚ÙŠ -->
    <div class="categories">
      <a
        href="{% url 'shop:index' %}"
        class="chip {% if active_all %}active{% endif %}"
        >Ø§Ù„ÙƒÙ„</a
      >
      {% if categories %} {% for c in categories %}
      <a
        href="{% url 'shop:category' c.slug %}"
        class="chip {% if selected_category and selected_category.id == c.id %}active{% endif %}"
        style="position: relative"
      >
        {{ c.name }} {% if c.show_label and c.label_text %}
        <span
          class="category-label"
          style="background-color: {{ c.label_color }}; margin-right:8px; padding:2px 6px; border-radius:6px; color:#fff; font-size:12px;"
        >
          {{ c.label_text }}
        </span>
        <lottie-player
          class="lottie"
          src="{% static 'animations/Fire.json' %}"
          background="transparent"
          speed="1"
          style="
            width: 24px;
            height: 24px;
            display: inline-block;
            vertical-align: middle;
          "
          loop
          autoplay
        >
        </lottie-player>
        {% endif %}
      </a>
      {% endfor %} {% else %}
      <span>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù….</span>
      {% endif %}
    </div>
  </div>
</div>

<!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div class="content" id="products">
  <div class="category-name">
    {% if selected_category %}
    <h2>{{ selected_category.name }}</h2>
    {% else %}
    <h2>ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
    {% endif %}
  </div>
  <div class="grid">
    {% if products %} {% for p in products %}
    <a href="{% url 'shop:product_detail' p.id %}" class="card-link">
      <div class="card">
        <div class="thumb">
          {% if p.images.all %}
          <img src="{{ p.images.first.image.url }}" alt="{{ p.name }}" />
          {% else %}
          <div class="placeholder">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø©</div>
          {% endif %}

          <!-- Ø²Ø±Ø§Ø± Ø§Ù„Ù€ wishlist -->
          <a
            href="#"
            class="wishlist-btn"
            data-id="{{ p.id }}"
            style="
              position: absolute;
              right: 5px;
              top: 5px;
              text-decoration: none;
              font-size: 25px;
              color: rgb(253 13 13);
              border-radius: 50% !important;
              padding: 5px !important;
              transition: all 0.3s ease !important;
            "
          >
            {% if p.id in user_wishlist %}
            <i class="fas fa-heart text-red-500"></i>
            {% else %}
            <i class="far fa-heart text-gray-400"></i>
            {% endif %}
          </a>

          <!-- ğŸ”¥ Ø§Ù„Ø´Ø¹Ù„Ø© ØªØ¸Ù‡Ø± Ù„Ùˆ ÙÙŠ Ø®ØµÙ… -->
          {% if p.discounted_price %}
          <lottie-player
            src="{% static 'animations/Fire.json' %}"
            background="transparent"
            speed="1"
            style="
              width: 40px;
              height: 40px;
              position: absolute;
              left: 5px;
              top: 5px;
              z-index: 2;
            "
            loop
            autoplay
          >
          </lottie-player>
          {% endif %}

          <!-- Ø§Ù„Ø³Ø¹Ø± -->
          <div class="price">
            {% if p.discounted_price %}
            <span class="old-price">{{ p.price }}</span>
            <span class="new-price">EGP {{ p.discounted_price }}</span>
            {% else %}
            <span class="normal-price">EGP {{ p.price }}</span>
            {% endif %}
          </div>
        </div>

        <div class="info">
          <h3 class="name">{{ p.name }}</h3>
        </div>
      </div>
    </a>
    {% endfor %} {% else %}
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.</p>
    {% endif %}
  </div>
</div>

<!-- Ø¨Ø§Ù†Ø±Ø§Øª -->
<div
  id="bannersCarousel"
  class="carousel slide my-5"
  data-bs-ride="carousel"
  style="max-width: 80vw; margin: auto"
>
  <div class="carousel-inner">
    {% if banners %} {% for banner in banners %}
    <div class="carousel-item {% if forloop.first %}active{% endif %}">
      {% if banner.link_category %}
      <a href="{% url 'shop:category' banner.link_category.slug %}">
        <img
          src="{{ banner.image.url }}"
          class="d-block w-100"
          alt="{{ banner.alt }}"
        />
      </a>
      {% else %}
      <img
        src="{{ banner.image.url }}"
        class="d-block w-100"
        alt="{{ banner.alt }}"
      />
      {% endif %}
    </div>
    {% endfor %} {% else %}
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨Ø§Ù†Ø±Ø§Øª.</p>
    {% endif %}
  </div>

  <!-- Ø§Ù„Ø£Ø³Ù‡Ù… -->
  <button
    class="carousel-control-prev"
    type="button"
    data-bs-target="#bannersCarousel"
    data-bs-slide="prev"
  >
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Ø§Ù„Ø³Ø§Ø¨Ù‚</span>
  </button>
  <button
    class="carousel-control-next"
    type="button"
    data-bs-target="#bannersCarousel"
    data-bs-slide="next"
  >
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Ø§Ù„ØªØ§Ù„ÙŠ</span>
  </button>
</div>

<style>
  .wishlist-btn:hover {
    transform: scale(1.2) !important;
    background: var(--gold) !important;
  }
  .old-price {
    color: red;
    text-decoration: line-through; /* Ø®Ø· Ù…Ù† Ø§Ù„Ù†Øµ */
    margin-right: 6px;
    font-size: 14px;
  }

  .new-price {
    color: green;
    font-weight: bold;
    font-size: 16px;
  }

  .price {
    display: flex;
    flex-direction: column;
  }

  .category-label {
    font-weight: bold;
    border-radius: 8px;
    padding: 2px 8px;
    margin-left: 4px;
  }

  .a {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #00000066;
    border-radius: 50%;
    padding: 6px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
  }

  .a:hover {
    transform: scale(1.2);
    background: var(--gold);
    color: #fff;
  }
  .fa-regular,
  .far {
    font-weight: 400;
    color: #fff;
  }
  #offersCarousel {
    max-width: 70vw !important;
    margin: auto;
  }
  .container {
    padding: 0px !important;
  }
  .thumb {
    position: relative;
    overflow: hidden;
    height: 78%;
    background: #fafafa;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .info {
    padding: 4px;
    display: unset;
    height: 22%;
  }
  .name {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    height: 100%;
    font-size: 16px;
    font-weight: 600;
    color: #333;
    text-align: center;
    padding: 0 8px;
    overflow: hidden;
    white-space: nowrap;
  }

  .thumb img {
    width: 100%;
    display: block;
  }

  .price {
    position: absolute;
    bottom: 8px;
    left: 0px;
    background: rgba(0, 0, 0, 0.6);
    padding: 4px 8px;
    font-size: 12px;
    font-weight: bold;
    border-radius: 6px;
  }

  #bannersCarousel {
    max-width: 100vw !important;
    margin: unset !important;
    .carousel-inner {
      height: fit-content; /* Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± */
      border-radius: 0px;
      overflow: hidden;
      margin: unset !important;
      width: 100%;
    }
  }
  #bannersCarousel img {
    height: 100%;
    object-fit: cover;
  }

  .card {
    flex: 0 0 calc(33.333% - 20px); /* 3 ÙƒØ±ÙˆØª ÙÙŠ Ø§Ù„ØµÙ */
    max-width: 300px;
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
    display: flex;
    flex-direction: column;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  }

  .thumb {
    height: 250px;
    background: #fafafa;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .thumb:hover img {
    transform: scale(1.1); /* ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„Ù‡ÙØ± */
  }

  .price {
    color: var(--gold);
    font-weight: bold;
    font-size: 18px;
    text-align: center;
    margin: 8px 0;
  }

  .card-link {
    text-decoration: none;
    color: inherit;
  }
  .content {
    background: #ffff;
    padding: 18px;
    margin-bottom: 25px;
  }
  .category-name h2 {
    font-size: 28px;
    text-align: center;
    font-weight: bold;
    color: #c79b4b;
    padding-bottom: 5px;
  }

  .carousel-inner {
    width: 65vw;
    height: 540px;
    margin: auto;
    border-radius: 12px;
    overflow: hidden;
  }

  .carousel-item img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ÙŠØ®Ù„ÙŠ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ù…Ù† ØºÙŠØ± Ù…Ø§ ØªØ¨ÙƒØ³Ù„ Ø£Ùˆ ØªØªØ´ÙˆÙ‡ */
    display: block;
  }
  .card {
    transition: all 0.3s ease; /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø­Ø±ÙƒØ© ØªØ¨Ù‚Ù‰ Ù†Ø§Ø¹Ù…Ø© */
  }

  @media (min-width: 1000px) {
    .lottie {
      width: 60px !important;
      height: 60px !important;
      display: inline-block;
      vertical-align: middle;
      position: absolute;
      left: 0px;
      top: -20px;
    }
    .grid {
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
    .card {
      height: 500px;
    }
    .thumb {
      height: 80%;
    }
    .info {
      height: 20%;
    }
    .name {
      font-size: 20px;
    }
    .categ {
      background: #ffffff;
      width: 31vw;
      height: 548px;
      padding: 8px;
      border-radius: 10px;
    }
    .categories {
      display: flex;
      gap: 10px;
      overflow-y: auto; /* Ø®Ù„ÙŠÙ‡ Ø¨Ø³ Ø¹Ù…ÙˆØ¯ÙŠ */
      overflow-x: hidden; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø§Ø³ÙƒØ±ÙˆÙ„ Ø§Ù„Ø£ÙÙ‚ÙŠ */
      /* padding-bottom: 8px; */
      /* margin-bottom: 16px; */
      flex-direction: column;
      width: 30vw;
      height: 530px;
    }
    .mb-5 {
      /* margin-bottom: 3rem !important; */
      margin-left: 0px !important;
    }
    .big {
      /* background-color: blueviolet; */
      display: flex;
      flex-direction: row-reverse;
      margin-bottom: 15px;
    }
    .container,
    .container-lg,
    .container-md,
    .container-sm,
    .container-xl {
      max-width: 100% !important;
    }
    .chip {
      white-space: nowrap;
      padding: 10px 16px;
      border-radius: 16px;
      background: #e7e7e7;
      color: #333;
      text-decoration: none;
      font-weight: 600;
      display: inline-block; /* Ù…Ù‡Ù… Ø¹Ø´Ø§Ù† Ø§Ù„Ø­Ø±ÙƒØ© ØªØ¨Ø§Ù† */
      max-width: 97%; /* ÙŠØ®Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø¯Ø¬ Ù‚Ø¯ Ø§Ù„Ù†Øµ Ø¨Ø³ */
      transition: all 0.3s ease;
    }

    .chip:hover {
      background: #c79b4b;
      color: #fff;
      transform: translateX(-8px); /* Ù‡ØªØ²ÙˆØ¯ Ø´ÙˆÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ© */
    }
    /* Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ø³ÙƒØ±ÙˆÙˆÙ„ Ù„Ù„Ù€ div.categories Ø¨Ø³ */
    .categories::-webkit-scrollbar {
      width: 10px; /* Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…ÙˆØ¯ */
    }

    .categories::-webkit-scrollbar-track {
      background: #f1f1f1; /* Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø± */
      border-radius: 10px;
      cursor: pointer !important;
    }

    .categories::-webkit-scrollbar-thumb {
      background: #c79b4b; /* Ù„ÙˆÙ† Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
      border-radius: 10px;
      cursor: pointer !important;
    }

    .categories::-webkit-scrollbar-thumb:hover {
      background: #a6782d; /* Ù„ÙˆÙ† Ø£ØºÙ…Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù‡ÙØ± */
    }
  }
  @media (min-width: 300px) and (max-width: 1000px) {
    .lottie {
      width: 35px !important;
      height: 35px !important;
      display: inline-block;
      vertical-align: middle;
      position: absolute;
      top: -9px;
      left: -10px;
    }
    .category-label {
      display: none;
    }
    .container {
      padding: unset;
    }
    #bannersCarousel {
      .carousel-inner {
        width: 100vw !important;
      }
    }
    #offersCarousel {
      max-width: 100% !important;
      margin: unset !important;
      margin-bottom: 25px !important;
    }
    .carousel-inner {
      width: 100%;
      height: fit-content;
    }
    .content {
      background: #ffff;
      border-radius: 10px;
      padding: 10px 0px !important;
      margin-bottom: 25px;
    }
    .card {
      flex: 0 0 calc(40% - 20px); /* ØµÙ ÙÙŠÙ‡ ÙƒØ§Ø±ØªÙŠÙ† */
    }
    .thumb {
      height: 78%;
      background: #fafafa;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .info {
      padding: 4px;
      display: unset;
      height: 22%;
    }
    .price {
      font-size: 12px;
    }

    .name {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      height: 100%;
      font-size: 3vw;
      font-weight: 600;
      color: #333;
      text-align: center;
      padding: 0 8px;
      overflow: hidden;
      white-space: nowrap;
      margin-top: 7%;
      margin-bottom: 0px;
    }
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const hasQuery = "{{ query|default:'' }}".trim();
    if (hasQuery) {
      const productsSection = document.getElementById("products");
      if (productsSection) {
        productsSection.scrollIntoView({ behavior: "smooth" });
      }
    }
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const hasQuery = "{{ query|default:'' }}".trim();
    const hasCategory = "{{ selected_category|default:'' }}".trim();

    if (hasQuery || hasCategory) {
      const productsSection = document.getElementById("products");
      if (productsSection) {
        productsSection.scrollIntoView({ behavior: "smooth" });
      }
    }
  });
</script>

{% endblock %}
